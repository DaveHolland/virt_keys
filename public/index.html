<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>Virtual Midi Keyboard</title>
		<link rel="stylesheet" href="css/midikb.css" />

<script language="javascript" > 

function BufferLoader(context, urlList, callback) {
  this.context = context;
  this.urlList = urlList;
  this.onload = callback;
  this.bufferList = new Array();
  this.loadCount = 0;
}

BufferLoader.prototype.loadBuffer = function(url, index) {
  // Load buffer asynchronously
  var request = new XMLHttpRequest();
  request.open("GET", url, true);
  request.responseType = "arraybuffer";

  var loader = this;

  request.onload = function() {
    // Asynchronously decode the audio file data in request.response
    loader.context.decodeAudioData(
      request.response,
      function(buffer) {
        if (!buffer) {
          alert('error decoding file data: ' + url);
          return;
        }
        loader.bufferList[index] = buffer;
        if (++loader.loadCount == loader.urlList.length)
          loader.onload(loader.bufferList);
      }
    );
  }

  request.onerror = function() {
    alert('BufferLoader: XHR error');
  }

  request.send();
}

BufferLoader.prototype.load = function() {
  for (var i = 0; i < this.urlList.length; ++i)
  this.loadBuffer(this.urlList[i], i);
}

window.onload = init;
var context;
var bufferLoader;

function init() {
  context = new webkitAudioContext();

  alert('About to load piano.  Are you using Google Chrome?');

  bufferLoader = new BufferLoader(
    context,
    [
	'wav/chimes.wav',
      'wav/PIANO_LOUD_C3s.wav',
      'wav/PIANO_LOUD_DB3s.wav',
	'wav/PIANO_LOUD_D3s.wav',
	'wav/PIANO_LOUD_EB3s.wav',
	'wav/PIANO_LOUD_E3s.wav',
	'wav/PIANO_LOUD_F3s.wav',
      'wav/PIANO_LOUD_GB3s.wav',
	'wav/PIANO_LOUD_G3s.wav',
	'wav/PIANO_LOUD_AB3s.wav',
	'wav/PIANO_LOUD_A3s.wav',
	'wav/PIANO_LOUD_BB3s.wav',
	'wav/PIANO_LOUD_B3s.wav',
	'wav/PIANO_LOUD_C4s.wav',
      'wav/PIANO_LOUD_DB4s.wav',
	'wav/PIANO_LOUD_D4s.wav',
	'wav/PIANO_LOUD_EB4s.wav',
	'wav/PIANO_LOUD_E4s.wav',
	'wav/PIANO_LOUD_F4s.wav',
      'wav/PIANO_LOUD_GB4s.wav',
	'wav/PIANO_LOUD_G4s.wav',
	'wav/PIANO_LOUD_AB4s.wav',
	'wav/PIANO_LOUD_A4s.wav',
	'wav/PIANO_LOUD_BB4s.wav',
	'wav/PIANO_LOUD_B4s.wav',
	'wav/PIANO_LOUD_C5s.wav'
    ],
    finishedLoading
    );
 alert('Done creating loader.  Wait till you hear the chimes!');
  bufferLoader.load();
}

function finishedLoading(bufferList) {

  // Create two sources and play them both together.
  var source1 = context.createBufferSource();
  var source2 = context.createBufferSource();

  source1.buffer = bufferList[0];
  source1.connect(context.destination);
  source1.noteOn(0);
}

</script>


		<script src="js/jin.js"></script>
		<script src="js/jin-gestures.js"></script>
		<script src="js/jin-ui.js"></script>
		<script src="js/midikb.js"></script>
	</head>
	<body>
    <td>
      <div align="left">
    		<embed src="FirstCircle9c.swf" id="as3_js" quality="high" scale="exactfit" width="1" height="1" name="squambido" align="middle" allowscriptaccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer"/>
      </div>
    </td>
	</body>
</html>